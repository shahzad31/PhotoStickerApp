"use strict";angular.module("photoStickerApp",["ngAnimate","ngResource","ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/home",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("photoStickerApp").controller("MainCtrl",["$scope","$uibModal","$log",function(a,b,c){function d(b,c){var d=new Image;d.src=b,d.onload=function(){var b=document.createElement("canvas");b.width=d.width,b.height=d.height;var e=b.getContext("2d");e.drawImage(d,0,0);var f=b.toDataURL("image/png");a.stickersCache.push({dataURL:f,title:c}),a.$$phase||a.$apply()}}a.setNavBarIcon=function(){alert()},window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser."),a.showStartOver=!1;var e=function(){var a="";for(var b in window.localStorage)window.localStorage.hasOwnProperty(b)&&(a+=window.localStorage[b]);return a?3+16*a.length/8388608:0};Math.round(e())>4999&&alert("Local Storage is exceeding 5MB limit"),a.stickersCache=[],"undefined"!=typeof Storage&&(localStorage.stickersCache?a.stickersCache=JSON.parse(localStorage.getItem("stickersCache")):a.stickersCache=[]);d("images/stickers/well-done.png","well done"),d("images/stickers/yeoman.png","yeoman"),a.open=function(){var c=b.open({animation:!0,templateUrl:"views/directives/modal-view.html",controller:"modalCtrl",resolve:{file:a.file}});c.result.then(function(b){if(a.file=b,b.id=a.stickersCache.length+1+b.title,a.stickersCache.push(b),localStorage.stickersCache)var c=angular.fromJson(localStorage.stickersCache);else c=[];c.push(b),localStorage.setItem("stickersCache",JSON.stringify(c))},function(){})}}]).controller("HeaderController",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("photoStickerApp").controller("AboutCtrl",["$scope",function(a){a.homeActive=!1,a.aboutActive=!0,a.contactActive=!1}]),angular.module("photoStickerApp").controller("ContactCtrl",["$scope",function(a){a.homeActive=!1,a.aboutActive=!1,a.contactActive=!0}]),angular.module("photoStickerApp").controller("modalCtrl",["$scope","$uibModalInstance",function(a,b){a.file={},a.submit=function(){a.file.title&&a.file.src&&b.close(a.file)},a.cancel=function(){b.dismiss("cancel")},a.getFile=function(b){if(b.type.match("image.*")){var c=new FileReader;c.onload=function(b){return function(b){a.file.dataURL=b.target.result}}(b),c.readAsDataURL(b)}}}]),function(){function a(a){a.remember("_draggable",this),this.el=a}a.prototype.init=function(a,b){var c=this;this.constraint=a,this.value=b,this.el.on("mousedown.drag",function(a){c.start(a)}),this.el.on("touchstart.drag",function(a){c.start(a)})},a.prototype.transformPoint=function(a,b){a=a||window.event;var c=a.changedTouches&&a.changedTouches[0]||a;return this.p.x=c.pageX-(b||0),this.p.y=c.pageY,this.p.matrixTransform(this.m)},a.prototype.getBBox=function(){var a=this.el.bbox();return this.el instanceof SVG.Nested&&(a=this.el.rbox()),(this.el instanceof SVG.G||this.el instanceof SVG.Use||this.el instanceof SVG.Nested)&&(a.x=this.el.x(),a.y=this.el.y()),a},a.prototype.start=function(a){if("click"!=a.type&&"mousedown"!=a.type&&"mousemove"!=a.type||1==(a.which||a.buttons)){var b=this;this.el.fire("beforedrag",{event:a,handler:this}),this.parent=this.parent||this.el.parent(SVG.Nested)||this.el.parent(SVG.Doc),this.p=this.parent.node.createSVGPoint(),this.m=this.el.node.getScreenCTM().inverse();var c,d=this.getBBox();if(this.el instanceof SVG.Text)switch(c=this.el.node.getComputedTextLength(),this.el.attr("text-anchor")){case"middle":c/=2;break;case"start":c=0}this.startPoints={point:this.transformPoint(a,c),box:d},SVG.on(window,"mousemove.drag",function(a){b.drag(a)}),SVG.on(window,"touchmove.drag",function(a){b.drag(a)}),SVG.on(window,"mouseup.drag",function(a){b.end(a)}),SVG.on(window,"touchend.drag",function(a){b.end(a)}),this.el.fire("dragstart",{event:a,p:this.p,m:this.m,handler:this}),a.preventDefault(),a.stopPropagation()}},a.prototype.drag=function(a){var b=this.getBBox(),c=this.transformPoint(a),d=this.startPoints.box.x+c.x-this.startPoints.point.x,e=this.startPoints.box.y+c.y-this.startPoints.point.y,f=this.constraint;if(this.el.fire("dragmove",{event:a,p:this.p,m:this.m,handler:this}),"function"==typeof f){var g=f.call(this.el,d,e,this.m);"boolean"==typeof g&&(g={x:g,y:g}),g.x===!0?this.el.x(d):g.x!==!1&&this.el.x(g.x),g.y===!0?this.el.y(e):g.y!==!1&&this.el.y(g.y)}else"object"==typeof f&&(null!=f.minX&&d<f.minX?d=f.minX:null!=f.maxX&&d>f.maxX-b.width&&(d=f.maxX-b.width),null!=f.minY&&e<f.minY?e=f.minY:null!=f.maxY&&e>f.maxY-b.height&&(e=f.maxY-b.height),this.el.move(d,e))},a.prototype.end=function(a){this.drag(a),this.el.fire("dragend",{event:a,p:this.p,m:this.m,handler:this}),SVG.off(window,"mousemove.drag"),SVG.off(window,"touchmove.drag"),SVG.off(window,"mouseup.drag"),SVG.off(window,"touchend.drag")},SVG.extend(SVG.Element,{draggable:function(b,c){("function"==typeof b||"object"==typeof b)&&(c=b,b=!0);var d=this.remember("_draggable")||new a(this);return b="undefined"==typeof b?!0:b,b?d.init(c||{},b):(this.off("mousedown.drag"),this.off("touchstart.drag")),this}})}.call(this),angular.module("photoStickerApp").directive("imageSvg",function(){return{link:function(a,b,c){function d(b){a.clearSvg&&(i.clear(),a.clearSvg=!1);var c=i.image(b.dataURL,b.width,b.height).x(b.posX).y(b.posY);c.draggable(),j.push(c),b.selected&&(c.select().resize(),c.selected=!0),c.click(function(){j.forEach(function(a,b){a.resize("stop"),a.select(!1),a.selected=!1}),c.select().resize(),c.selected=!0})}function e(b){i.clear(),a.clearSvg=!1,h=i.image(b),h.click(function(){j.forEach(function(a,b){a.resize("stop"),a.select(!1)})}),h.size("100%","100%"),a.showStartOver=!0,a.$$phase||a.$apply()}function f(a){a.stopPropagation(),a.preventDefault();for(var b,c=a.target.files||a.dataTransfer.files,d=0;b=c[d];d++)if(b.type.match("image.*")){var f=new FileReader;h&&h.remove(),f.onload=function(a){return function(a){j=[],a.target.result&&e(a.target.result)}}(b),f.readAsDataURL(b)}}function g(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="drop Image"}var h,i=(b.find("svg")[0],SVG("mainSvg")),j=[];a.clearSvg=!0;var k=i.text("Drop photo here").move($(i.node).width()/2,$(i.node).height()/2);if(k.font({size:20,anchor:"middle",leading:1}),localStorage.getItem("dataToPersist")){var l=angular.fromJson(localStorage.getItem("dataToPersist"));l.mainImageDataURL&&e(l.mainImageDataURL),l.stickersList&&l.stickersList.forEach(function(a,b){d(a)})}var m=b.find("svg")[0],n=b.find("#fileBtn");$(m).droppable({drop:function(a,b){var c=b.draggable[0];c.posX=b.offset.left-$(this).offset().left,c.posY=b.offset.top-$(this).offset().top,c.dataURL=c.src,d(c)}}),m.addEventListener("dragover",g,!1),m.addEventListener("drop",f,!1),n.on("change",f),a.startOver=function(){localStorage.removeItem("dataToPersist"),j=[],h=null,i.clear();var b=i.text("Drop photo here").move($(m.node).width()/2,$(m.node).height()/2);b.font({size:20,anchor:"middle",leading:1}),a.clearSvg=!0},a.exportSvg=function(){j.forEach(function(a,b){a.resize("stop"),a.select(!1)});var a=document.querySelector("svg");a.setAttribute("width",$(a).width()),a.setAttribute("height",$(a).height());var b=(new XMLSerializer).serializeToString(a),c=$("<a>").attr("href","data:image/svg+xml;base64,"+btoa(b)).attr("download","file.svg").appendTo("body");c[0].click(),c.remove()},a.exportImage=function(){j.forEach(function(a,b){a.resize("stop"),a.select(!1)});var a=document.querySelector("svg");a.setAttribute("width",$(a).width()),a.setAttribute("height",$(a).height());var b=(new XMLSerializer).serializeToString(a),c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width.animVal.value,c.height=a.height.animVal.value;var e=document.createElement("img");e.setAttribute("src","data:image/svg+xml;base64,"+btoa(b)),e.width=c.width,e.height=c.height,e.onload=function(){d.drawImage(e,0,0,e.width,e.height);var a=c.toDataURL("image/png"),b=$("<a>").attr("href",a).attr("download","img.png").appendTo("body");b[0].click(),b.remove()}},window.addEventListener("beforeunload",function(){var a={};h&&(a.mainImageDataURL=h.src);var b=[];j.forEach(function(a,c){b.push({dataURL:a.src,selected:a.selected||!1,posX:a.x(),posY:a.y()})}),a.stickersList=b,localStorage.setItem("dataToPersist",angular.toJson(a))})}}}),angular.module("photoStickerApp").directive("draggableImg",["$document",function(a){return{link:function(a,b,c){b.draggable({revert:!0,refreshPositions:!0,revertDuration:0,helper:"clone",appendTo:"body",containment:"window",scroll:!1,drag:function(a,b){b.helper.addClass("draggable")},stop:function(a,b){}})}}}]),function(){function a(a,b,c){if(b){var d="",e=b===!0?"  ":b||"";for(i=c-1;i>=0;i--)d+=e;a=d+a+"\n"}return a}SVG.extend(SVG.Element,{exportSvg:function(b,c){var d,e,f,g,h,i,j=this.node.nodeName,k="";if(b=b||{},null==b.exclude||!b.exclude.call(this)){if(b=b||{},c=c||0,this instanceof SVG.Doc&&(k+=a('<?xml version="1.0" encoding="UTF-8"?>',b.whitespace,c),f=this.attr("width"),g=this.attr("height"),b.width&&this.attr("width",b.width),b.height&&this.attr("height",b.height)),k+=a("<"+j+this.attrToString()+">",b.whitespace,c),this instanceof SVG.Doc&&(this.attr({width:f,height:g}),k+=a("<desc>Created with svg.js [http://svgjs.com]</desc>",b.whitespace,c+1),k+=this.defs().exportSvg(b,c+1)),this instanceof SVG.Parent)for(d=0,e=this.children().length;e>d;d++)SVG.Absorbee&&this.children()[d]instanceof SVG.Absorbee?(i=this.children()[d].node.cloneNode(!0),h=document.createElement("div"),h.appendChild(i),k+=h.innerHTML):k+=this.children()[d].exportSvg(b,c+1);else if(this instanceof SVG.Text||this instanceof SVG.TSpan)for(d=0,e=this.node.childNodes.length;e>d;d++)k+=this.node.childNodes[d].instance instanceof SVG.TSpan?this.node.childNodes[d].instance.exportSvg(b,c+1):this.node.childNodes[d].nodeValue.replace(/&/g,"&amp;");else SVG.ComponentTransferEffect&&this instanceof SVG.ComponentTransferEffect&&this.rgb.each(function(){k+=this.exportSvg(b,c+1)});k+=a("</"+j+">",b.whitespace,c)}return k},exportAttr:function(a){return 0==arguments.length?this.data("svg-export-attr"):this.data("svg-export-attr",a)},attrToString:function(){var a,b,c=[],d=this.exportAttr(),e=this.attr();if("object"==typeof d)for(a in d)"data-svg-export-attr"!=a&&(e[a]=d[a]);for(a in e)b=e[a],"xlink"==a?a="xmlns:xlink":"href"==a&&(e["xlink:href"]||(a="xlink:href")),"string"==typeof b&&(b=b.replace(/"/g,"'")),"data-svg-export-attr"!=a&&"href"!=a&&("stroke"!=a||parseFloat(e["stroke-width"])>0)&&c.push(a+'="'+b+'"');return c.length?" "+c.join(" "):""}})}.call(this),function(a){function b(a){this.el=a,this.parent=a.parent(SVG.Nested)||a.parent(SVG.Doc),a.remember("_selectHandler",this),this.pointSelection={isSelected:!1},this.rectSelection={isSelected:!1}}b.prototype.init=function(b,c){var d=this.el.bbox();this.options={};for(var e in this.el.select.defaults)this.options[e]=this.el.select.defaults[e],c[e]!==a&&(this.options[e]=c[e]);this.nested=(this.nested||this.parent.nested()).size(d.width||1,d.height||1).transform(this.el.ctm()).move(d.x,d.y),this.options.deepSelect&&-1!==["line","polyline","polygon"].indexOf(this.el.type)?this.selectPoints(b):this.selectRect(b),this.observe(),this.cleanup()},b.prototype.selectPoints=function(a){return this.pointSelection.isSelected=a,this.pointSelection.set?this:(this.pointSelection.set=this.parent.set(),this.drawCircles(),this)},b.prototype.getPointArray=function(){var a=this.el.bbox();return this.el.array().valueOf().map(function(b){return[b[0]-a.x,b[1]-a.y]})},b.prototype.drawCircles=function(){for(var a=this,b=this.getPointArray(),c=0,d=b.length;d>c;++c)this.pointSelection.set.add(this.nested.circle(this.options.radius).center(b[c][0],b[c][1]).addClass(this.options.classPoints).addClass(this.options.classPoints+"_point").mousedown(function(b){return function(c){c=c||window.event,c.preventDefault?c.preventDefault():c.returnValue=!1,a.el.fire("point",{x:c.pageX,y:c.pageY,i:b,event:c})}}(c)))},b.prototype.updatePointSelection=function(){var a=this.getPointArray();this.pointSelection.set.each(function(b){(this.cx()!==a[b][0]||this.cy()!==a[b][1])&&this.center(a[b][0],a[b][1])})},b.prototype.updateRectSelection=function(){var a=this.el.bbox();this.rectSelection.set.get(0).attr({width:a.width,height:a.height}),this.options.points&&(this.rectSelection.set.get(2).center(a.width,0),this.rectSelection.set.get(3).center(a.width,a.height),this.rectSelection.set.get(4).center(0,a.height),this.rectSelection.set.get(5).center(a.width/2,0),this.rectSelection.set.get(6).center(a.width,a.height/2),this.rectSelection.set.get(7).center(a.width/2,a.height),this.rectSelection.set.get(8).center(0,a.height/2)),this.options.rotationPoint&&this.rectSelection.set.get(9).center(a.width/2,20)},b.prototype.selectRect=function(a){function b(a){return function(b){b=b||window.event,b.preventDefault?b.preventDefault():b.returnValue=!1,c.el.fire(a,{x:b.pageX,y:b.pageY,event:b})}}var c=this,d=this.el.bbox();this.rectSelection.isSelected=a,this.rectSelection.set=this.rectSelection.set||this.parent.set(),this.rectSelection.set.get(0)||this.rectSelection.set.add(this.nested.rect(d.width,d.height).addClass(this.options.classRect)),this.options.points&&!this.rectSelection.set.get(1)&&(this.rectSelection.set.add(this.nested.circle(this.options.radius).center(0,0).attr("class",this.options.classPoints+"_lt").mousedown(b("lt"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(d.width,0).attr("class",this.options.classPoints+"_rt").mousedown(b("rt"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(d.width,d.height).attr("class",this.options.classPoints+"_rb").mousedown(b("rb"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(0,d.height).attr("class",this.options.classPoints+"_lb").mousedown(b("lb"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(d.width/2,0).attr("class",this.options.classPoints+"_t").mousedown(b("t"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(d.width,d.height/2).attr("class",this.options.classPoints+"_r").mousedown(b("r"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(d.width/2,d.height).attr("class",this.options.classPoints+"_b").mousedown(b("b"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(0,d.height/2).attr("class",this.options.classPoints+"_l").mousedown(b("l"))),this.rectSelection.set.each(function(){this.addClass(c.options.classPoints)})),this.options.rotationPoint&&!this.rectSelection.set.get(9)&&this.rectSelection.set.add(this.nested.circle(this.options.radius).center(d.width/2,20).attr("class",this.options.classPoints+"_rot").mousedown(function(a){a=a||window.event,a.preventDefault?a.preventDefault():a.returnValue=!1,c.el.fire("rot",{x:a.pageX,y:a.pageY,event:a})}))},b.prototype.handler=function(){var a=this.el.bbox();this.nested.size(a.width||1,a.height||1).transform(this.el.ctm()).move(a.x,a.y),this.rectSelection.isSelected&&this.updateRectSelection(),this.pointSelection.isSelected&&this.updatePointSelection()},b.prototype.observe=function(){var a=this;if(MutationObserver)if(this.rectSelection.isSelected||this.pointSelection.isSelected)this.observerInst=this.observerInst||new MutationObserver(function(){a.handler()}),this.observerInst.observe(this.el.node,{attributes:!0});else try{this.observerInst.disconnect(),delete this.observerInst}catch(b){}else this.el.off("DOMAttrModified.select"),(this.rectSelection.isSelected||this.pointSelection.isSelected)&&this.el.on("DOMAttrModified.select",function(){a.handler()})},b.prototype.cleanup=function(){!this.rectSelection.isSelected&&this.rectSelection.set&&(this.rectSelection.set.each(function(){this.remove()}),this.rectSelection.set.clear(),delete this.rectSelection.set),!this.pointSelection.isSelected&&this.pointSelection.set&&(this.pointSelection.set.each(function(){this.remove()}),this.pointSelection.set.clear(),delete this.pointSelection.set),this.pointSelection.isSelected||this.rectSelection.isSelected||(this.nested.remove(),delete this.nested)},SVG.extend(SVG.Element,{select:function(c,d){"object"==typeof c&&(d=c,c=!0);var e=this.remember("_selectHandler")||new b(this);return e.init(c===a?!0:c,d||{}),this}}),SVG.Element.prototype.select.defaults={points:!0,classRect:"svg_select_boundingRect",classPoints:"svg_select_points",radius:7,rotationPoint:!0,deepSelect:!1}}.call(this),function(){function a(a){a.remember("_resizeHandler",this),this.el=a,this.parameters={},this.lastUpdateCall=null,this.p=a.doc().node.createSVGPoint()}a.prototype.transformPoint=function(a,b,c){return this.p.x=a-(this.offset.x-window.pageXOffset),this.p.y=b-(this.offset.y-window.pageYOffset),this.p.matrixTransform(c||this.m)},a.prototype.init=function(a){var b=this;if(this.stop(),"stop"!==a){this.options={};for(var c in this.el.resize.defaults)this.options[c]=this.el.resize.defaults[c],"undefined"!=typeof a[c]&&(this.options[c]=a[c]);this.el.on("lt.resize",function(a){b.resize(a||window.event)}),this.el.on("rt.resize",function(a){b.resize(a||window.event)}),this.el.on("rb.resize",function(a){b.resize(a||window.event)}),this.el.on("lb.resize",function(a){b.resize(a||window.event)}),this.el.on("t.resize",function(a){b.resize(a||window.event)}),this.el.on("r.resize",function(a){b.resize(a||window.event)}),this.el.on("b.resize",function(a){b.resize(a||window.event)}),this.el.on("l.resize",function(a){b.resize(a||window.event)}),this.el.on("rot.resize",function(a){b.resize(a||window.event)}),this.el.on("point.resize",function(a){b.resize(a||window.event)}),this.update()}},a.prototype.stop=function(){return this.el.off("lt.resize"),this.el.off("rt.resize"),this.el.off("rb.resize"),this.el.off("lb.resize"),this.el.off("t.resize"),this.el.off("r.resize"),this.el.off("b.resize"),this.el.off("l.resize"),this.el.off("rot.resize"),this.el.off("point.resize"),this},a.prototype.resize=function(a){var b=this;if(this.m=this.el.node.getScreenCTM().inverse(),this.offset={x:window.pageXOffset,y:window.pageYOffset},this.parameters={p:this.transformPoint(a.detail.event.clientX,a.detail.event.clientY),x:a.detail.x,y:a.detail.y,box:this.el.bbox(),rotation:this.el.transform().rotation},void 0!==a.detail.i){var c=this.el.array().valueOf();this.parameters.i=a.detail.i,this.parameters.pointCoords=[c[a.detail.i][0],c[a.detail.i][1]]}switch(a.type){case"lt":this.calc=function(a,b){var c=this.snapToGrid(a,b);this.parameters.box.width-c[0]>0&&this.parameters.box.height-c[1]>0&&this.el.move(this.parameters.box.x+c[0],this.parameters.box.y+c[1]).size(this.parameters.box.width-c[0],this.parameters.box.height-c[1])};break;case"rt":this.calc=function(a,b){var c=this.snapToGrid(a,b,2);this.parameters.box.width+c[0]>0&&this.parameters.box.height-c[1]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y+c[1]).size(this.parameters.box.width+c[0],this.parameters.box.height-c[1])};break;case"rb":this.calc=function(a,b){var c=this.snapToGrid(a,b,0);this.parameters.box.width+c[0]>0&&this.parameters.box.height+c[1]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y).size(this.parameters.box.width+c[0],this.parameters.box.height+c[1])};break;case"lb":this.calc=function(a,b){var c=this.snapToGrid(a,b,1);this.parameters.box.width-c[0]>0&&this.parameters.box.height+c[1]>0&&this.el.move(this.parameters.box.x+c[0],this.parameters.box.y).size(this.parameters.box.width-c[0],this.parameters.box.height+c[1])};break;case"t":this.calc=function(a,b){var c=this.snapToGrid(a,b,2);this.parameters.box.height-c[1]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y+c[1]).height(this.parameters.box.height-c[1])};break;case"r":this.calc=function(a,b){var c=this.snapToGrid(a,b,0);this.parameters.box.width+c[0]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y).width(this.parameters.box.width+c[0])};break;case"b":this.calc=function(a,b){var c=this.snapToGrid(a,b,0);this.parameters.box.height+c[1]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y).height(this.parameters.box.height+c[1])};break;case"l":this.calc=function(a,b){var c=this.snapToGrid(a,b,1);this.parameters.box.width-c[0]>0&&this.el.move(this.parameters.box.x+c[0],this.parameters.box.y).width(this.parameters.box.width-c[0])};break;case"rot":this.calc=function(a,b){var c={x:a+this.parameters.p.x,y:b+this.parameters.p.y},d=Math.atan2(this.parameters.p.y-this.parameters.box.y-this.parameters.box.height/2,this.parameters.p.x-this.parameters.box.x-this.parameters.box.width/2),e=Math.atan2(c.y-this.parameters.box.y-this.parameters.box.height/2,c.x-this.parameters.box.x-this.parameters.box.width/2),f=180*(e-d)/Math.PI;this.el.center(this.parameters.box.cx,this.parameters.box.cy).rotate(this.parameters.rotation+f-f%this.options.snapToAngle,this.parameters.box.cx,this.parameters.box.cy)};break;case"point":this.calc=function(a,b){var c=this.snapToGrid(a,b,this.parameters.pointCoords[0],this.parameters.pointCoords[1]),d=this.el.array().valueOf();d[this.parameters.i][0]=this.parameters.pointCoords[0]+c[0],d[this.parameters.i][1]=this.parameters.pointCoords[1]+c[1],this.el.plot(d)}}SVG.on(window,"mousemove.resize",function(a){b.update(a||window.event)}),SVG.on(window,"mouseup.resize",function(){b.done()})},a.prototype.update=function(a){if(!a)return void(this.lastUpdateCall&&this.calc(this.lastUpdateCall[0],this.lastUpdateCall[1]));var b=this.transformPoint(a.clientX,a.clientY),c=b.x-this.parameters.p.x,d=b.y-this.parameters.p.y;this.lastUpdateCall=[c,d],this.calc(c,d)},a.prototype.done=function(){this.lastUpdateCall=null,SVG.off(window,"mousemove.resize"),SVG.off(window,"mouseup.resize"),this.el.fire("resizedone")},a.prototype.snapToGrid=function(a,b,c,d){var e;return d?e=[(c+a)%this.options.snapToGrid,(d+b)%this.options.snapToGrid]:(c=null==c?3:c,e=[(this.parameters.box.x+a+(1&c?0:this.parameters.box.width))%this.options.snapToGrid,(this.parameters.box.y+b+(2&c?0:this.parameters.box.height))%this.options.snapToGrid]),a-=(Math.abs(e[0])<this.options.snapToGrid/2?e[0]:e[0]-this.options.snapToGrid)+(e[0]<0?this.options.snapToGrid:0),b-=(Math.abs(e[1])<this.options.snapToGrid/2?e[1]:e[1]-this.options.snapToGrid)+(e[1]<0?this.options.snapToGrid:0),[a,b]},SVG.extend(SVG.Element,{resize:function(b){return(this.remember("_resizeHandler")||new a(this)).init(b||{}),this}}),SVG.Element.prototype.resize.defaults={snapToAngle:.1,snapToGrid:1}}.call(this),angular.module("photoStickerApp").directive("ngFileSelect",function(){return{link:function(a,b){b.bind("change",function(b){a.imageFile=(b.srcElement||b.target).files[0],a.file.src=a.imageFile.name,a.$apply(),a.getFile(a.imageFile)})}}}),angular.module("photoStickerApp").directive("stickerItem",["$document",function(a){return{templateUrl:"views/directives/sticker-item.html",restrict:"E",scope:!1,link:function(a,b,c){a.removeSticker=function(b){var c=a.stickersCache.indexOf(b);c>-1&&a.stickersCache.splice(c,1);var d=angular.fromJson(localStorage.stickersCache),e=d.indexOf(b);d.splice(e,1),localStorage.stickersCache=angular.toJson(d)}}}}]),angular.module("photoStickerApp").run(["$templateCache",function(a){a.put("views/about.html",'<p>This is photo sticker application built in angular js .</p> <p>Following other libraries have been used <uo> <li>Jquery</li> <li>Svg.js</li> </uo> </p> <p>github Repositery for this project is <a href="https://github.com/shahzad31/PhotoStickerApp">https://github.com/shahzad31/PhotoStickerApp</a></p>'),a.put("views/contact.html",'<p> You can contact the author at <a href="mailto:shahzad31comp@gmail.com" target="_top">shahzad31comp@gmail.com</a> </p>'),a.put("views/directives/image-svg.html",""),a.put("views/directives/modal-view.html",'<div class="modal-header"> <h3 class="modal-title">Upload New Sticker</h3> </div> <div class="modal-body"> <form class="form-horizontal"> <div class="form-group"> <label for="inputSticker" class="col-sm-3 control-label">Sticker Name</label> <div class="col-sm-6"> <input type="text" class="form-control" ng-model="file.title" id="inputSticker" placeholder="Sticker Name" autofocus required> </div> </div> <div class="form-group"> <label for="inputSticker" class="col-sm-3 control-label">File Source</label> <div class="col-sm-6"> <input type="text" class="form-control" ng-model="file.src" id="fileName" placeholder="File Name" required ng-readonly="true"> </div> <form action="" method="post" enctype="multipart/form-data"> <div class="upload col-sm-4"> <input type="file" name="upload" ng-file-select> </div> </form> </div> </form> </div> <div class="modal-footer"> <button class="btn btn-primary" type="submit" ng-click="submit()">Submit</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button> </div>'),a.put("views/directives/sticker-item.html",'<!--Layout of a sticker item--> <div class="col-xs-6 col-centered col-min sticker-main"> <div class="sticker-item" ng-mouseover="mouseOver=true" ng-mouseleave="mouseOver=false"> <span class="glyphicon glyphicon-remove" title="Remove this sticker" ng-click="removeSticker(sticker)" ng-show="mouseOver" aria-hidden="true"></span> <h4 class="headline"> {{sticker.title}} </h4> <image class="sticker-image" ng-src="{{sticker.dataURL}}" draggable-img></image> </div> </div>'),a.put("views/main.html",'<div class="container" image-svg> <div class="row"> <div class="col-lg-8"> <div class="jumbotron svg-area"> <!--using ng-class instead of ng-show because it was disturbing layout--> <button ng-class="{\'hideStartOverClass\': !showStartOver}" class="start-over-button btn btn-danger col-xs-2 pull-right" ng-click="startOver()">Start Over</button> <div class="svgContainer"> <svg id="mainSvg"></svg> </div> <div class="btnArea"> <input type="file" class="col-xs-10" id="fileBtn" name="img" accept="image/*"> <div> <div class="btn-group" uib-dropdown is-open="status.isopen"> <button id="single-button" type="button" class="btn btn-success" uib-dropdown-toggle ng-disabled="disabled"> Export As <span class="caret"></span> </button> <ul class="uib-dropdown-menu" role="menu" aria-labelledby="single-button"> <li role="menuitem"><a ng-click="exportImage()">image/png</a></li> <li role="menuitem"><a ng-click="exportSvg()">svg+xml</a></li> </ul> </div> </div> </div> </div> </div> <div class="col-lg-4"> <div class="jumbotron sticker-area"> <button class="btn btn-md btn-primary" ng-click="open()" type="submit">Upload new sticker</button> <div class="stickers"> <sticker-item ng-repeat="(index, sticker) in stickersCache"></sticker-item> </div> </div> </div> </div> </div>')}]);